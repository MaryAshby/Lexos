{% extends "base_analyze.html" %}
{% set active_page = 'kmeans' %}

{% block head %}
    <script type="text/javascript"
            src="{{ url_for('static', filename='js/scripts_kmeans.js') }}?ver={{ version }}"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- Latest compiled and minimized DataTables CSS -->
    <link rel="stylesheet" type="text/css"
          href="https://cdn.datatables.net/u/bs/jszip-2.5.0,pdfmake-0.1.18,dt-1.10.12,b-1.2.1,b-html5-1.2.1,b-print-1.2.1,fc-3.2.2,fh-3.1.2,se-1.2.0/datatables.min.css"/>

    <!-- Latest compiled and minimized DataTables JS -->
    <script type="text/javascript"
            src="https://cdn.datatables.net/u/bs/jszip-2.5.0,pdfmake-0.1.18,dt-1.10.12,b-1.2.1,b-html5-1.2.1,b-print-1.2.1,fc-3.2.2,fh-3.1.2,se-1.2.0/datatables.min.js"></script>

{% endblock %}

{% block title %}K-Means Clustering{% endblock %}

{% block options %}
    <input type="hidden" id="num_active_files" value="{{ numActiveDocs }}"/>
    <fieldset>
        <legend>K-Means Options</legend>
        <div class="kmeans-options cf" id="kmeanscreateoptions">

            <label for="n_clusters">Number of Clusters (K-Value):
                <input type="number" name="nclusters" id="nclusters" min="1" step="1" max="{{numActiveDocs}}" placeholder="Default is {{ defaultK }}" value="{{ session['kmeanoption']['nclusters'] }}" />
                <i class="fa fa-question-circle lexos-tooltip-trigger"
                   data-toggle="tooltip" data-html="true"
                   data-placement="right" data-container="body"
                   title="The number of clusters or the number of centroids. The K-value should be always less or equal to the number of active documents."
                   style=""></i>
            </label>

            <label for="viz">Method of Visualization:
                <select name="viz" id="vizMethod">
                    <option value="Voronoi" {{ 'selected' if session['kmeanoption']['viz'] == 'Voronoi' }}>Voronoi</option>
                    <option value="PCA" {{ 'selected' if session['kmeanoption']['viz'] == 'PCA' }}>PCA</option>
                </select>
                <i class="fa fa-question-circle lexos-tooltip-trigger"
                   data-toggle="tooltip" data-html="true"
                   data-placement="right" data-container="body"
                   title='Choose either a <a href="https://en.wikipedia.org/wiki/Principal_component_analysis" target="_blank">Principal Component Analysis (PCA)</a> graph of xy coordinates with document points colored to reflect document clusters or a <a href="https://en.wikipedia.org/wiki/Voronoi_diagram" target="_blank">Voronoi diagram</a> with polygons drawn around them to represent document clusters.'
                   style=""></i>
            </label>

        </div>
    </fieldset>

    <fieldset>
        <legend class="has-chevron">Advanced K-Means Options
            <span id="kmeansAdvancedChev"
                  class="fa fa-chevron-right rotate {{ 'showing' if session['kmeanoption']['n_init'] != '' or session['kmeanoption']['tolerance'] != '' }}" data-target="#advancedkmeansOpts" aria-expanded="false" aria-controls="advancedkmeansOpts">
            </span>
        </legend>

        <div class="collapse" id="advancedkmeansOpts">
            <label for="max_iter">Maximum Number of Iterations:
                <input type="number" name="max_iter" id="max_iter" min="1" step="1" placeholder="Default is 300" value="{{ session['kmeanoption']['max_iter'] }}" />
                <i class="fa fa-question-circle lexos-tooltip-trigger" data-toggle="tooltip" data-html="true" data-placement="right" data-container="body" title="Maximum number of iterations of the k-means algorithm for a single run." style="font-size:12px;"></i>
            </label>

            <label for="init">Method of Initialization:
                <select name="init" id="initMethod">
                    <option value="k-means++" {{ 'selected' if session['kmeanoption']['init'] == 'k-means++' }}>k-means++</option>
                    <option value="random" {{ 'selected' if session['kmeanoption']['init'] == 'random' }}>random</option>
                </select>
                <i class="fa fa-question-circle lexos-tooltip-trigger"
                   data-toggle="tooltip" data-html="true"
                   data-placement="right" data-container="body"
                   title="'k-means++' selects initial cluster centers for k-means clustering using a weighted probability distribution to speed up convergence. The 'random' option chooses k observations (rows) at random from data for the initial centroids."
                   style="font-size:12px;"></i>
            </label>

            <label for="n_init">Number of Iterations with Different Centroids:
                <input type="number" name="n_init" id="n_init" placeholder="Default is 10" min="1" step="1" value="{{ session['kmeanoption']['n_init'] }}" />
                <i class="fa fa-question-circle lexos-tooltip-trigger"
                   data-toggle="tooltip" data-html="true"
                   data-placement="right" data-container="body"
                   title="The number of time the k-means algorithm will be run with different centroid seeds. The final results will be the best output of n_init consecutive runs in terms of inertia."
                   style="font-size:12px;"></i>
            </label>

            <label for="tolerance">Relative Tolerance:
                <input type="number" name="tolerance" placeholder="Default is 1e-4" id="tolerance" step=".0001" value="{{ session['kmeanoption']['tolerance'] }}" />
                <i class="fa fa-question-circle lexos-tooltip-trigger"
                   data-toggle="tooltip" data-html="true"
                   data-placement="right" data-container="body"
                   title="Decimal, relative tolerance with respect to inertia to declare convergence."
                   style="font-size:12px;"></i>
            </label>
        </div>
    </fieldset>


{% endblock %}

{% block results %}
    <div class="row submit-button-row">
        <div class="col-md-12">
            <input type="button" class="bttn bttn-action" id="get-k-means-result"
                   name="get-k-means-result" value="Get KMeans Result"/>
        </div>
    </div>
    <div id="KMeans-result" class="row col-lg-12 col-md-12">
        <div id="KMeans-table" class="row col-lg-3 col-md-3"></div>
        <div id="KMeans-plot" class="row col-lg-offset-1 col-md-offset-1 col-lg-8 col-md-8"></div>
    </div>
{% endblock %}

{% block submit %}
{% endblock %}
