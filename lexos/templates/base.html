<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Lexos</title>

    {%- set version = "3.2.0" %}

    <meta http-equiv="cache-control" content="max-age=0"/>
    <meta http-equiv="expires" content="0"/>
    <meta http-equiv="pragma" content="no-cache"/>

    <!-- === jQuery Core === -->
    {% if config['LOCAL_MODE'] == True %}
        <script type="text/javascript"
                src="{{ url_for('static', filename='node_modules/jquery/dist/jquery.min.js') }}?ver={{ version }}"></script>
    {% else %}
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    {% endif %}

    <!-- === Load jQuery UI only for selected pages === -->
    {% set needs_jQuery_ui = ['wordcloud', 'multicloud'] -%}
    {% if active_page in needs_jQuery_ui %}
        {% if config['LOCAL_MODE'] == True %}
            <link rel="stylesheet"
                  href="{{ url_for('static', filename='node_modules/jquery-ui/themes/base/jquery-ui.min.css') }}?ver={{ version }}">
            <script type="text/javascript"
                    src="{{ url_for('static', filename='node_modules/jquery-ui/jquery-ui.min.js') }}?ver={{ version }}"></script>
        {% else %}
            <link rel="stylesheet"
                  href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
            <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
        {% endif %}
    {% endif %}

    <!-- === Load d3.js only for selected pages === -->
    {% set needs_d3 = ['wordcloud', 'multicloud', 'viz', 'kmeans', 'rollingwindow'] -%}
    {% if active_page in needs_d3 %}
        {% if config['LOCAL_MODE'] == True %}
            <script type="text/javascript"
                    src="{{ url_for('static', filename='node_modules/d3/d3.min.js') }}?ver={{ version }}"></script>
        {% else %}
            <script type="text/javascript"
                    src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
        {% endif %}
    {% endif %}

    <!-- === Bootstrap === -->
    {% if config['LOCAL_MODE'] == True %}
        <link rel="stylesheet"
              href="{{ url_for('static', filename='node_modules/bootstrap/dist/css/bootstrap.min.css') }}?ver={{ version }}">
        <script type="text/javascript"
                src="{{ url_for('static', filename='node_modules/bootstrap/dist/js/bootstrap.min.js') }}?ver={{ version }}"></script>
    {% else %}
        <link rel="stylesheet"
              href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
              integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
              crossorigin="anonymous">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
                integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
                crossorigin="anonymous"></script>
    {% endif %}

    <!-- === SmartMenus jQuery plugin CSS === -->
    <link rel="stylesheet"
          href="{{ url_for('static', filename='node_modules/smartmenus/dist/addons/bootstrap/jquery.smartmenus.bootstrap.css') }}?ver={{ version }}"/>
    <script type="text/javascript"
            src="{{ url_for('static', filename='node_modules/smartmenus/dist/jquery.smartmenus.min.js') }}?ver={{ version }}"></script>

    <!-- SmartMenus jQuery Bootstrap Addon -->
    <script type="text/javascript"
            src="{{ url_for('static', filename='node_modules/smartmenus/dist/addons/bootstrap/jquery.smartmenus.bootstrap.js') }}?ver={{ version }}"></script>

    <!-- === Font Awesome === -->
    {% if config['LOCAL_MODE'] == True %}
        <link rel="stylesheet"
              href="{{ url_for('static', filename='node_modules/font-awesome/css/font-awesome.min.css') }}?ver={{ version }}">
    {% else %}
        <link rel="stylesheet"
              href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    {% endif %}

    <!-- Lexos Scripts -->
    <script type="text/javascript"
            src="{{ url_for('static', filename='js/scripts_icons.js') }}?ver={{ version }}"></script>
    <script type="text/javascript"
            src="{{ url_for('static', filename='js/scripts_base.js') }}?ver={{ version }}"></script>
    <script type="text/javascript"
            src="{{ url_for('static', filename='js/scripts_ITM.js') }}?ver={{ version }}"></script>

    <!-- Lexos CSS -->
    <link rel="stylesheet" type="text/css" media="all"
          href="{{ url_for('static', filename='css/style.css') }}?ver={{ version }}"/>
    <link rel="stylesheet" type="text/css" media="all"
          href="{{ url_for('static', filename='css/iconfonts.css') }}?ver={{ version }}"/>
    <link rel="stylesheet" type="text/css" media="all"
          href="{{ url_for('static', filename='css/ITMtabStyles.css') }}?ver={{ version }}"/>
    <link rel="stylesheet" type="text/css" media="all"
          href="{{ url_for('static', filename='css/bootstrap-override.css') }}?ver={{ version }}"/>
    <link rel="shortcut icon"
          href="{{ url_for('static', filename='favicon.png') }}?ver={{ version }}"/>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Quicksand:300,400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600" rel="stylesheet">

    {% block section_head %}{% endblock %}
    {% block head %}{% endblock %}
</head>

<body>
<header>
    <!-- Session ID and current version -->
    <input type="hidden" name="current_id" value="{{ session['id'] }}"/>
    <input type="hidden" name="current_version" value="{{ version }}"/>

    <!-- Loading indicator -->
    <div id="loading-indicator">
    </div>

    <!-- Navbar -->
    <div id="navbar">
        <div id="navbar-left">
            <h1>{L}exos</h1>
        </div>
        <div id="navbar-right">
            <a href="/upload">Upload</a>
            <a href="/manage">Manage</a>
            <h3 class="selectable">Prepare</h3>
            <h3 class="selectable">Visualize</h3>
            <h3 class="selectable">Analyze</h3>
            <h3>|</h3>
            <a href="/downloadworkspace">Save</a>
            <a href="/reset">Reset</a>
            <h3>|</h3>
            <h3 class="selectable">Options</h3>
        </div>
    </div>

    <!-- Navbar Spacer -->
    <div id="navbar-spacer"></div>
</header>

<!-- Main Content -->
<main class="container">
    <form method="POST" enctype="multipart/form-data">
        {% block content %}
            <!-- Default content -->
        {% endblock %}
    </form>
</main>

<!-- Footer -->
<footer class="container">

</footer>

<!-- Settings Dialog -->
<div class="modal fade" id="settings-modal" tabindex="-1" role="dialog"
     aria-labelledby="settings-modalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content panel-primary">
            <div class="modal-header panel-heading">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="settings-modalLabel">About
                    Lexos</h4>
            </div>
            <div class="modal-body"
                 style="max-height: calc(100vh - 210px); overflow-y: auto;">
                <p>Lexos is a web-based tool designed for transforming,
                    analyzing, and visualizing texts. Lexos is designed for use
                    primarily with small to medium-sized text collections, and
                    especially for use with ancient languages and languages
                    that do not employ the Latin alphabet. Lexos was created as
                    an entry-level platform for Humanities scholars and
                    students new to computational techniques while providing
                    tools and techniques sophisticated enough for advanced
                    research. <a href="http://scalar.usc.edu/works/lexos"
                                 target="_blank">Read more...</a></p>
                <p>The Lexos Manual can be found in its <a
                        href="http://scalar.usc.edu/works/lexos"
                        target="_blank"><em>In the Margins</em></a> component,
                    which can be accessed by clicking the side panel icon on
                    the left edge of the screen. The <em>In the Margins</em>
                    panel can be accessed anywhere in the Lexos interface, or
                    it can be opened by clicking <a id="cog-toggler" href="#">this
                        link</a>. You can also read <a
                            href="http://scalar.usc.edu/works/lexos"
                            target="_blank"><em>In the Margins</em></a> as a
                    separate "book" on the <a
                            href="http://scalar.usc.edu/scalar/"
                            target="_blank">Scalar</a> web platform. In
                    addition to the "how to" manual, it contains more in-depth
                    discussion and bibliography on issues and best practices in
                    computational stylistics.</p>
                <h4>Settings</h4>
                <p>Beta functions are new features in Lexos which are not yet
                    fully tested. If you enable them, the functions will become
                    visible in the Lexos interface. But please use them with
                    caution.</p>
                <form id="settingsform">
                    <label id="beta_on" for="beta_onbox">
                        <input type="checkbox" name="beta_onbox"
                               id="beta_onbox" {{ "checked" if session['generalsettings']['beta_onbox'] }}>
                        Use Beta functions
                    </label>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="savesettings" class="btn btn-default"
                        data-dismiss="modal">Save Settings
                </button>
                <button type="button" id="closesettings"
                        class="btn btn-default" data-dismiss="modal">Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- In the Margins Dialog -->
<div class="modal fade" id="ITM-modal" tabindex="-1" role="dialog"
     aria-labelledby="ITM-modalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="ITM-modalLabel"><em>In the
                    Margins</em></h4>
            </div>
            <div class="modal-body"
                 style="max-height: calc(100vh - 210px); overflow-y: auto;">
                <label id="beta_on" for="beta_onbox">
                    <input type="checkbox" name="beta_onbox" id="beta_onbox"
                            {# "checked" if session['general_settings']['beta_on'] #}>
                    Use Beta functions
                </label>
                <div id="dialog-status">
                    <i class="fa fa-spinner fa-spin fa-2x fa-fw"
                       style="color: #0068AF;"></i>
                    <span class="sr-only">Loading...</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">Close
                </button>
                <!-- <button id="show-video" type="button" class="btn btn-primary">Show Video</button> -->
            </div>
        </div>
    </div>
</div>

<!-- Error Modal -->
<div id="error-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-sm">
        <!-- Modal content-->
        <div class="modal-content panel-danger">
            <div class="modal-header panel-heading">
                <button type="button" class="close" data-dismiss="modal">
                    &times;
                </button>
                <h4 class="modal-title">Error!</h4>
            </div>
            <div class="modal-body">
                <p id="error-modal-message">You have no active documents.
                    Please activate at least one document using the <a
                            href="{{ url_for("manage.manage") }}">Manage</a>
                    tool or <a href="{{ url_for("upload.upload") }}">upload</a>
                    a new document.</p>
            </div>
        </div>
    </div>
</div>

<!-- Warning Modal -->
<div id="warning-modal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <!-- Modal content-->
        <div class="modal-content panel-warning">
            <div class="modal-header panel-heading">
                <button type="button" class="close" data-dismiss="modal">
                    &times;
                </button>
                <h4 class="warning-modal-title">Warning!</h4>
            </div>
            <div id="warning-modal-body" class="modal-body">
                <p id="warning-modal-message"></p>
            </div>
            <div id="warning-modal-footer" class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">Cancel
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Error Message -->
<span id="error-message"></span>

<!-- End Container -->

<script type="text/javascript">
  var _gaq = _gaq || []
  _gaq.push(['_setAccount', 'UA-42990457-1'])
  _gaq.push(['_trackPageview']);

  (function () {
    var ga = document.createElement('script')
    ga.type = 'text/javascript'
    ga.async = true
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'
    var s = document.getElementsByTagName('script')[0]
    s.parentNode.insertBefore(ga, s)
  })()
</script>
<!-- In the Margins Panel -->
<div id="ITMPanel" class="container sidebar sidebar-left"
     style="width:500px;position:absolute;left:-500px;">
    <div id="ITMPanel-itm-content" data-slug="{{ itm }}" data-type="panel"
         data-status="closed" style="max-height:99%;overflow-y:auto;">
        <div class="row" style="padding: 0 !important;margin: 0 !important;">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg1-12" data-side=""
                 style="padding: 0 !important;margin: 0 !important;">
                <div id="itm-header" style="padding:2px 20px;"><h3>In the
                    Margins</h3></div>
                <div id="itm-content" style="padding:2px 20px;"></div>
                <div id="panel-status">
                    <i class="fa fa-spinner fa-spin fa-2x fa-fw"
                       style="color: #0068AF;"></i>
                    <span class="sr-only">Loading...</span>
                </div>
            </div>
        </div>
    </div>
    <div id="toggler" class="toggler">
        <span class="glyphicon glyphicon-chevron-right" style="display:block;">&nbsp;</span>
        <span class="glyphicon glyphicon-chevron-left" style="display:none;">&nbsp;</span>
    </div>
</div>
<!--/In the Margins Panel  -->

</body>
</html>
